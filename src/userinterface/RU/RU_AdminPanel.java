/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JPanel.java to edit this template
 */
package userinterface.RU;

import Business.EcoSystem;
import Business.RU.RU_Company;
import Business.Role.Role;
import Business.UserAccount.UserAccount;
import Business.UserAccount.UserAccountDirectory;
import Business.Voucher.Voucher;
import Business.Voucher.VoucherDirectory;
import Validations.Functions;
import java.util.ArrayList;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.table.DefaultTableModel;

/**
 *
 * @author saket
 */
public class RU_AdminPanel extends javax.swing.JPanel {

    /**
     * Creates new form RU_CompanyRewardsManager
     */
    JPanel userProcessContainer;
    EcoSystem ecosystem;
    RU_Company company;
    UserAccount account;
    
    public RU_AdminPanel(JPanel userProcessContainer,EcoSystem ecosystem, UserAccount account, RU_Company company) {
        initComponents();
        this.userProcessContainer = userProcessContainer;
        this.ecosystem = ecosystem;
        this.company = company;
        this.account = account;
        
        populateTable(ecosystem.getVoucherDirectory(),company);
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        wsu_adminJpanel = new javax.swing.JLabel();
        btnDeleteVoucher = new javax.swing.JButton();
        btnCreateVoucher = new javax.swing.JButton();
        jScrollPane1 = new javax.swing.JScrollPane();
        table = new javax.swing.JTable();
        lblCompanyAdminUsername = new javax.swing.JLabel();
        lblCompanyAdminPassword = new javax.swing.JLabel();
        txtRewardDescription = new javax.swing.JTextField();
        txtRewardCost = new javax.swing.JTextField();
        lblCompanyRewardsManagerName = new javax.swing.JLabel();
        lblUsername = new javax.swing.JLabel();
        jLabel1 = new javax.swing.JLabel();

        setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        wsu_adminJpanel.setFont(new java.awt.Font("Helvetica", 1, 18)); // NOI18N
        wsu_adminJpanel.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        wsu_adminJpanel.setText("MANAGE VOUCHERS");
        add(wsu_adminJpanel, new org.netbeans.lib.awtextra.AbsoluteConstraints(220, 40, 360, 60));

        btnDeleteVoucher.setText("Delete");
        btnDeleteVoucher.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnDeleteVoucherActionPerformed(evt);
            }
        });
        add(btnDeleteVoucher, new org.netbeans.lib.awtextra.AbsoluteConstraints(710, 130, -1, -1));

        btnCreateVoucher.setText("Create Voucher");
        btnCreateVoucher.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnCreateVoucherActionPerformed(evt);
            }
        });
        add(btnCreateVoucher, new org.netbeans.lib.awtextra.AbsoluteConstraints(390, 440, -1, -1));

        table.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null},
                {null, null, null},
                {null, null, null},
                {null, null, null}
            },
            new String [] {
                "Id", "Reward Description", "Reward Cost ($)"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false, false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        jScrollPane1.setViewportView(table);

        add(jScrollPane1, new org.netbeans.lib.awtextra.AbsoluteConstraints(70, 120, 640, 179));

        lblCompanyAdminUsername.setFont(new java.awt.Font("Helvetica", 1, 13)); // NOI18N
        lblCompanyAdminUsername.setText("Reward Description:");
        add(lblCompanyAdminUsername, new org.netbeans.lib.awtextra.AbsoluteConstraints(290, 350, 140, 25));

        lblCompanyAdminPassword.setFont(new java.awt.Font("Helvetica", 1, 13)); // NOI18N
        lblCompanyAdminPassword.setText("Reward Cost ($):");
        add(lblCompanyAdminPassword, new org.netbeans.lib.awtextra.AbsoluteConstraints(290, 380, -1, 25));

        txtRewardDescription.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0), 2));
        add(txtRewardDescription, new org.netbeans.lib.awtextra.AbsoluteConstraints(430, 350, 114, -1));

        txtRewardCost.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0), 2));
        add(txtRewardCost, new org.netbeans.lib.awtextra.AbsoluteConstraints(430, 380, 114, -1));

        lblCompanyRewardsManagerName.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
        lblCompanyRewardsManagerName.setText("Welcome:");
        add(lblCompanyRewardsManagerName, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 20, -1, 20));

        lblUsername.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        lblUsername.setText("jLabel4");
        add(lblUsername, new org.netbeans.lib.awtextra.AbsoluteConstraints(100, 20, -1, 20));

        jLabel1.setIcon(new javax.swing.ImageIcon(getClass().getResource("/userinterface/images/rewards.png"))); // NOI18N
        add(jLabel1, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 0, 800, 600));
    }// </editor-fold>//GEN-END:initComponents

    private void btnCreateVoucherActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnCreateVoucherActionPerformed
        // TODO add your handling code here:
        if(txtRewardDescription.getText().length() <= 2) {
            JOptionPane.showMessageDialog(this, "Reward Description should be atleast 2 characters!!", null,JOptionPane.ERROR_MESSAGE);
            return;
        }
        if(!Functions.isValidNumber(txtRewardCost.getText())) {
            JOptionPane.showMessageDialog(this, "Please enter a valid voucher cost!", null,JOptionPane.ERROR_MESSAGE);
            return;
        }
        String desc = txtRewardDescription.getText();
        double cost = Double.parseDouble(txtRewardCost.getText());
        
        Voucher newVoucher = new Voucher();
        newVoucher.setVoucherCompanyId(company.getId());
        newVoucher.setVoucherDescription(desc);
        newVoucher.setVoucherWorth(cost);
        
        ecosystem.getVoucherDirectory().createVoucher(newVoucher);
        
        refreshData();
        clearInputs();
    }//GEN-LAST:event_btnCreateVoucherActionPerformed

    private void btnDeleteVoucherActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnDeleteVoucherActionPerformed
        // TODO add your handling code here:
        int selectedRowIndex = table.getSelectedRow();
        if (selectedRowIndex >= 0){
            int input = JOptionPane.showConfirmDialog(null, "Are you sure?", "Confirmation Dialog", JOptionPane.YES_NO_OPTION, JOptionPane.WARNING_MESSAGE);
            if (input == 0) {
                DefaultTableModel model = (DefaultTableModel) table.getModel();
                Voucher selectedRowData = (Voucher) model.getValueAt(selectedRowIndex, 0);
                ecosystem.getVoucherDirectory().removeVoucherById(selectedRowData.getId());
                clearInputs();
                refreshData();
                JOptionPane.showMessageDialog(this, "Delete Success");
            }
        } else {
            JOptionPane.showMessageDialog(this, "Select a user to delete");
        }
    }//GEN-LAST:event_btnDeleteVoucherActionPerformed


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnCreateVoucher;
    private javax.swing.JButton btnDeleteVoucher;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JLabel lblCompanyAdminPassword;
    private javax.swing.JLabel lblCompanyAdminUsername;
    private javax.swing.JLabel lblCompanyRewardsManagerName;
    private javax.swing.JLabel lblUsername;
    private javax.swing.JTable table;
    private javax.swing.JTextField txtRewardCost;
    private javax.swing.JTextField txtRewardDescription;
    private javax.swing.JLabel wsu_adminJpanel;
    // End of variables declaration//GEN-END:variables
 private void populateTable(VoucherDirectory voucherDirectory, RU_Company myCompany) {
        lblUsername.setText(account.getUsername());
        javax.swing.table.DefaultTableModel model = (javax.swing.table.DefaultTableModel)table.getModel();
        model.setRowCount(0);
        
        // loopthrough userName
        for (Voucher s: voucherDirectory.getVoucherDirectory()){
            if(s.getVoucherCompanyId() == myCompany.getId()) {
                Object[] row = new Object[3];
                row[0] = s;
                row[1] = s.getVoucherDescription();
                row[2] = s.getVoucherWorth();
           
           model.addRow(row);
            }
        }
    }

    private void clearInputs() {
        txtRewardCost.setText("");
        txtRewardDescription.setText("");
    }

    private void refreshData() {
        populateTable(ecosystem.getVoucherDirectory(), company);
    }
}
